(function NGPROTO_MAIN() {
    window.NGPROTO = { components: {}, styles: {} };
    let head = document.getElementsByTagName('head')[0];
    var es = new EventSource("/NGPROTO");
    es.onmessage = function (event) {
        try {
            let data = JSON.parse(event.data);
            if (data.selector) {
                let cId = NGPROTO.components[data.selector.toUpperCase()];
                let sel = `style[ngp-style-id='${cId}']`
                let styleEl = document.querySelectorAll(sel)
                if (styleEl) styleEl[0].innerText = data.styles.replace(/%COMP%/g, cId)
            }
        } catch(err) {
            console.log("Couldnt parse event data")
        }
        
    };
}());
